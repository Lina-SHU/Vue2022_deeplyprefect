import{S as a}from"./sweetalert2.all-88e394a7.js";import{M as y,p as D}from"./modal-1b5b2bed.js";import{_ as M,o as u,c as m,e as t,t as c,j as r,I as p,K as V,r as _,F as T,i as E,f}from"./index-b2a44858.js";import"./component-functions-0c9c55c1.js";const{VITE_URL:b,VITE_PATH:g}={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"lina-vueapi",BASE_URL:"/Vue2022_week6/",MODE:"production",DEV:!1,PROD:!0},k={props:["tempCoupon"],data(){return{editMsg:"",temp:{},date:""}},methods:{openModal(){this.editMsg.show()},closeModal(){this.editMsg.hide()},editCoupon(){if(this.temp.percent>100||this.temp.percent<0){a.fire({title:"優惠券折扣需在 100 內！",icon:"warning"});return}if(new Date(this.date)<new Date){a.fire({title:"到期日需大於今日",icon:"warning"});return}let s=`${b}api/${g}/admin/coupon/${this.temp.id}`,e="put";this.temp.id||(s=`${b}api/${g}/admin/coupon`,e="post"),this.temp.due_date=Math.floor(new Date(this.date)/1e3),this.$http[e](s,{data:this.temp}).then(()=>{this.$emit("getCoupons"),this.closeModal(),this.temp.id?a.fire({toast:!0,title:"編輯優惠券成功！",icon:"success",timer:2e3,position:"top-end",showConfirmButton:!1}):a.fire({toast:!0,title:"新增優惠券成功！",icon:"success",timer:2e3,position:"top-end",showConfirmButton:!1}),this.temp={}}).catch(i=>{a.fire({title:i.response.data.message,icon:"error"})})}},watch:{tempCoupon(){this.temp={...this.tempCoupon},this.temp.is_enabled=this.temp.is_enabled||0,this.temp.due_date?this.date=`${new Date(this.temp.due_date*1e3).getFullYear()}-${("0"+(new Date(this.temp.due_date*1e3).getMonth()+1)).slice(-2)}-${("0"+new Date(this.temp.due_date*1e3).getDate()).slice(-2)}`:this.date=""}},mounted(){this.editMsg=new y(this.$refs.editCouponModal)}},x={class:"modal",ref:"editCouponModal"},P={class:"modal-dialog modal-dialog-centered"},L={class:"modal-content"},U={class:"modal-header"},B={class:"modal-title fs-5"},I=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body"},A={class:"mb-3"},S=t("label",{for:"couponName",class:"form-label"},"名稱",-1),H={class:"mb-3"},O=t("label",{for:"couponCode",class:"form-label"},"代碼",-1),G={class:"mb-3"},N=t("label",{for:"couponDiscount",class:"form-label"},"折扣數",-1),F={class:"mb-3"},j=t("label",{for:"couponDiscount",class:"form-label"},"到期日",-1),K={class:"mb-3"},Y={class:"form-check"},q=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),z={class:"modal-footer"},J=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Q(s,e,i,h,o,d){return u(),m("div",x,[t("div",P,[t("div",L,[t("div",U,[t("h2",B,c(o.temp.id?"編輯":"新增")+"優惠券 ",1),I]),t("div",R,[t("div",A,[S,r(t("input",{type:"text",class:"form-control",id:"couponName","onUpdate:modelValue":e[0]||(e[0]=n=>o.temp.title=n)},null,512),[[p,o.temp.title]])]),t("div",H,[O,r(t("input",{type:"text",class:"form-control",id:"couponCode","onUpdate:modelValue":e[1]||(e[1]=n=>o.temp.code=n)},null,512),[[p,o.temp.code,void 0,{trim:!0}]])]),t("div",G,[N,r(t("input",{type:"number",class:"form-control",id:"couponDiscount","onUpdate:modelValue":e[2]||(e[2]=n=>o.temp.percent=n),max:"100"},null,512),[[p,o.temp.percent,void 0,{number:!0}]])]),t("div",F,[j,r(t("input",{type:"date",class:"form-control",id:"couponDiscount","onUpdate:modelValue":e[3]||(e[3]=n=>o.date=n)},null,512),[[p,o.date]])]),t("div",K,[t("div",Y,[r(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=n=>o.temp.is_enabled=n)},null,512),[[V,o.temp.is_enabled]]),q])])]),t("div",z,[J,t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...n)=>d.editCoupon&&d.editCoupon(...n))},c(o.temp.id?"編輯":"新增"),1)])])])],512)}const W=M(k,[["render",Q]]),{VITE_URL:C,VITE_PATH:v}={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"lina-vueapi",BASE_URL:"/Vue2022_week6/",MODE:"production",DEV:!1,PROD:!0},X={components:{pagination:D,editModal:W},data(){return{couponList:[],pages:{},tempCoupon:{},currentPage:1}},methods:{getCurrentPage(s){this.currentPage=s,this.getOrders(this.currentPage)},getCoupons(s=1){const e=`${C}api/${v}/admin/coupons?page=${s}`;this.$http.get(e).then(i=>{this.couponList=i.data.coupons,this.pages=i.data.pagination}).catch(i=>{a.fire({title:i.response.data.message,icon:"error"})})},deleteCoupon(s){const e=`${C}api/${v}/admin/coupon/${s}`;a.fire({title:"確認是否刪除此優惠券？",showCancelButton:!0,confirmButtonText:"刪除",cancelButtonText:"取消"}).then(i=>{i.isConfirmed&&this.$http.delete(e).then(()=>{this.getCoupons(),a.fire({toast:!0,title:"已刪除優惠券",icon:"success",timer:2e3,showConfirmButton:!1})}).catch(h=>{a.fire({title:h.response.data.message,icon:"error"})})})},openModal(s,e){s==="edit"?this.tempCoupon={...e}:s==="new"&&(this.tempCoupon={}),this.$refs.editMsg.openModal()}},mounted(){this.getCoupons()}},Z={class:"container py-5"},tt={class:"row justify-content-center"},et={class:"col-lg-10"},ot=t("h1",{class:"fs-5 mb-3"},"優惠券管理",-1),st={class:"text-end"},nt={class:"table"},it=t("thead",null,[t("tr",null,[t("th",null,"優惠券名稱"),t("th",null,"優惠券代碼"),t("th",null,"折扣數"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th")])],-1),lt=["onClick"],at=["onClick"];function dt(s,e,i,h,o,d){const n=_("pagination"),w=_("editModal");return u(),m("div",Z,[t("div",tt,[t("div",et,[ot,t("div",st,[t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=l=>d.openModal("new"))}," 建立新的優惠券 ")]),t("table",nt,[it,t("tbody",null,[(u(!0),m(T,null,E(o.couponList,l=>(u(),m("tr",{key:l.id},[t("td",null,c(l.title),1),t("td",null,c(l.code),1),t("td",null,c(l.percent),1),t("td",null,c(new Date(l.due_date*1e3).toLocaleDateString()),1),t("td",null,c(l.is_enabled?"是":"否"),1),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:$=>d.openModal("edit",l)}," 編輯 ",8,lt),t("button",{type:"button",class:"btn btn-sm btn-outline-danger ms-1",onClick:$=>d.deleteCoupon(l.id)}," 刪除 ",8,at)])]))),128))])]),f(n,{class:"mt-2",pages:o.pages,onGetCurrentPage:d.getCurrentPage},null,8,["pages","onGetCurrentPage"])])]),f(w,{ref:"editMsg","temp-coupon":o.tempCoupon,onGetCoupons:d.getCoupons},null,8,["temp-coupon","onGetCoupons"])])}const mt=M(X,[["render",dt]]);export{mt as default};
