import{S as _}from"./sweetalert2.all-1dda703d.js";import{M as I,p as L}from"./modal-f1a2700c.js";import{_ as B,r as y,o as n,c as r,e as t,t as b,f as i,w as R,H as f,F as v,i as w,j as g,J as V,I as U,M as S}from"./index-f37b75d8.js";import"./component-functions-7a0269a1.js";const{VITE_URL:M,VITE_PATH:C}={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"lina-vueapi",BASE_URL:"/Vue2022_deeplyprefect/",MODE:"production",DEV:!1,PROD:!0},q={props:["tempProduct"],data(){return{fileData:"",temp:[],editMsg:""}},methods:{openModal(){this.editMsg.show()},closeModal(){this.editMsg.hide()},getFile(l){this.fileData=l.target.files[0]},updateFile(){const l=new FormData;l.append("file-to-upload",this.fileData);const s=`${M}api/${C}/admin/upload`;this.$http.post(s,l).then(d=>{this.temp.imageUrl=d.data.imageUrl}).catch(d=>{_.fire({title:d.response.data.message,icon:"error"})})},editProduct(){let l=`${M}api/${C}/admin/product/${this.temp.id}`,s="put";this.temp.id||(l=`${M}api/${C}/admin/product`,s="post"),this.$http[s](l,{data:this.temp}).then(()=>{this.$emit("getProduct"),this.closeModal(),this.temp.id?_.fire({toast:!0,title:"編輯商品成功！",icon:"success",timer:2e3,position:"top-end",showConfirmButton:!1}):_.fire({toast:!0,title:"新增商品成功！",icon:"success",timer:2e3,position:"top-end",showConfirmButton:!1}),this.temp={}}).catch(d=>{_.fire({title:d.response.data.message,icon:"error"})})}},watch:{tempProduct(){this.temp={...this.tempProduct}}},mounted(){this.editMsg=new I(this.$refs.editModal)}},H={class:"modal",ref:"editModal"},G={class:"modal-dialog modal-xl"},O={class:"modal-content"},N={class:"modal-header"},j={class:"modal-title fs-5"},z=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},K={class:"row"},Q={class:"col-sm-4"},W={class:"mb-3"},X={class:"mb-2"},Y=t("label",{for:"formFile",class:"form-label"},"輸入圖片網址",-1),Z={class:"input-group"},$=["src","alt"],tt=t("h3",{class:"fs-6 mb-3"},"輸入標籤",-1),et=["onUpdate:modelValue"],st={key:0,class:"mt-3"},ot={key:1,class:"mt-3"},lt={class:"col-sm-8"},it={class:"mb-3"},nt=t("label",{for:"title",class:"form-label"},"標題",-1),rt={class:"row"},dt={class:"mb-3 col-md-6"},at=t("label",{for:"category",class:"form-label"},"分類",-1),ct={class:"mb-3 col-md-6"},mt=t("label",{for:"price",class:"form-label"},"單位",-1),ut={class:"row"},pt={class:"mb-3 col-md-6"},_t=t("label",{for:"origin_price",class:"form-label"},"原價",-1),ht={class:"mb-3 col-md-6"},bt=t("label",{for:"price",class:"form-label"},"售價",-1),ft=t("hr",null,null,-1),gt={class:"mb-3"},vt=t("label",{for:"description",class:"form-label"},"商品描述",-1),yt={class:"mb-3"},Vt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Pt={class:"mb-3"},kt={class:"form-check"},Ut=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Mt=t("h3",{class:"fs-6 mb-3"},"輸入多張圖片網址",-1),Ct={class:"row"},wt=["onUpdate:modelValue"],xt=["src"],Tt={key:0,class:"mt-3"},Et={key:1,class:"mt-3"},Ft={class:"text-end mt-5"},Dt=t("button",{type:"button",class:"btn btn-outline-primary-dark","data-bs-dismiss":"modal"}," 取消 ",-1),At={type:"submit",class:"btn btn-primary-dark ms-3"};function Bt(l,s,d,P,e,c){const m=y("VField"),u=y("error-message"),a=y("VForm");return n(),r("div",H,[t("div",G,[t("div",O,[t("div",N,[t("h2",j,b(e.temp.id?"編輯":"新增")+"商品",1),z]),t("div",J,[i(a,{onSubmit:c.editProduct},{default:R(({errors:p})=>{var x,T,E,F;return[t("div",K,[t("div",Q,[t("div",W,[t("div",X,[Y,t("div",Z,[i(m,{type:"file",class:f(["form-control",{"is-invalid":p.圖片網址}]),id:"formFile",onChange:s[0]||(s[0]=o=>c.getFile(o)),name:"圖片網址",rules:"required"},null,8,["class"]),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[1]||(s[1]=(...o)=>c.updateFile&&c.updateFile(...o))}," 上傳檔案 ")]),i(u,{name:"圖片網址",class:"invalid-feedback"})]),t("img",{class:"img-fluid",src:e.temp.imageUrl,alt:e.temp.title},null,8,$)]),Array.isArray(e.temp.tags)?(n(),r(v,{key:0},[tt,(n(!0),r(v,null,w(e.temp.tags,(o,h)=>(n(),r("div",{key:o+"789",class:"mb-2"},[g(t("input",{type:"text",class:"form-control","onUpdate:modelValue":k=>e.temp.tags[h]=k},null,8,et),[[V,e.temp.tags[h]]])]))),128)),!((T=(x=e.temp)==null?void 0:x.tags)!=null&&T.length)||e.temp.tags[e.temp.tags.length-1]?(n(),r("div",st,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:s[2]||(s[2]=o=>e.temp.tags.push(""))}," 新增標籤 ")])):(n(),r("div",ot,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm d-block w-100",onClick:s[3]||(s[3]=o=>e.temp.tags.pop())}," 刪除標籤 ")]))],64)):U("",!0)]),t("div",lt,[t("div",it,[nt,i(m,{id:"title",type:"text",class:f(["form-control",{"is-invalid":p.標題}]),placeholder:"請輸入標題",modelValue:e.temp.title,"onUpdate:modelValue":s[4]||(s[4]=o=>e.temp.title=o),modelModifiers:{trim:!0},name:"標題",rules:"required"},null,8,["modelValue","class"]),i(u,{name:"標題",class:"invalid-feedback"})]),t("div",rt,[t("div",dt,[at,i(m,{id:"category",type:"text",class:f(["form-control",{"is-invalid":p.分類}]),placeholder:"請輸入分類",modelValue:e.temp.category,"onUpdate:modelValue":s[5]||(s[5]=o=>e.temp.category=o),modelModifiers:{trim:!0},name:"分類",rules:"required"},null,8,["modelValue","class"]),i(u,{name:"分類",class:"invalid-feedback"})]),t("div",ct,[mt,i(m,{id:"unit",type:"text",class:f(["form-control",{"is-invalid":p.單位}]),placeholder:"請輸入單位",modelValue:e.temp.unit,"onUpdate:modelValue":s[6]||(s[6]=o=>e.temp.unit=o),modelModifiers:{trim:!0},name:"單位",rules:"required"},null,8,["modelValue","class"]),i(u,{name:"單位",class:"invalid-feedback"})])]),t("div",ut,[t("div",pt,[_t,i(m,{id:"origin_price",type:"number",min:"0",class:f(["form-control",{"is-invalid":p.原價}]),placeholder:"請輸入原價",modelValue:e.temp.origin_price,"onUpdate:modelValue":s[7]||(s[7]=o=>e.temp.origin_price=o),modelModifiers:{number:!0},name:"原價",rules:"required"},null,8,["modelValue","class"]),i(u,{name:"原價",class:"invalid-feedback"})]),t("div",ht,[bt,i(m,{id:"price",type:"number",min:"0",class:f(["form-control",{"is-invalid":p.售價}]),placeholder:"請輸入售價",modelValue:e.temp.price,"onUpdate:modelValue":s[8]||(s[8]=o=>e.temp.price=o),modelModifiers:{number:!0},name:"售價",rules:"required"},null,8,["modelValue","class"]),i(u,{name:"售價",class:"invalid-feedback"})])]),ft,t("div",gt,[vt,g(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸商品描述","onUpdate:modelValue":s[9]||(s[9]=o=>e.temp.description=o)},null,512),[[V,e.temp.description,void 0,{trim:!0}]])]),t("div",yt,[Vt,g(t("textarea",{id:"content",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":s[10]||(s[10]=o=>e.temp.content=o)},null,512),[[V,e.temp.content,void 0,{trim:!0}]])]),t("div",Pt,[t("div",kt,[g(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":s[11]||(s[11]=o=>e.temp.is_enabled=o)},null,512),[[S,e.temp.is_enabled]]),Ut])])])]),Array.isArray(e.temp.imagesUrl)?(n(),r(v,{key:0},[Mt,t("div",Ct,[(n(!0),r(v,null,w(e.temp.imagesUrl,(o,h)=>(n(),r("div",{key:o,class:"col-md-4"},[g(t("input",{type:"text","onUpdate:modelValue":k=>e.temp.imagesUrl[h]=k,class:"form-control"},null,8,wt),[[V,e.temp.imagesUrl[h]]]),e.temp.imagesUrl[h]?(n(),r("img",{key:0,src:e.temp.imagesUrl[h],alt:"多張圖片網址",class:"img-fluid"},null,8,xt)):U("",!0)]))),128))]),!((F=(E=e.temp)==null?void 0:E.imagesUrl)!=null&&F.length)||e.temp.imagesUrl[e.temp.imagesUrl.length-1]?(n(),r("div",Tt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:s[12]||(s[12]=o=>e.temp.imagesUrl.push(""))}," 新增圖片 ")])):(n(),r("div",Et,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:s[13]||(s[13]=o=>e.temp.imagesUrl.pop())}," 刪除圖片 ")]))],64)):U("",!0),t("div",Ft,[Dt,t("button",At,b(e.temp.id?"編輯":"新增"),1)])]}),_:1},8,["onSubmit"])])])])],512)}const It=B(q,[["render",Bt]]),{VITE_URL:D,VITE_PATH:A}={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"lina-vueapi",BASE_URL:"/Vue2022_deeplyprefect/",MODE:"production",DEV:!1,PROD:!0},Lt={components:{pagination:L,editModal:It},data(){return{productList:[],pages:{},tempProduct:{},currentPage:1}},methods:{getCurrentPage(l){this.currentPage=l,this.getProducts(this.currentPage)},getProducts(l=1){const s=`${D}api/${A}/admin/products?page=${l}`;this.$http.get(s).then(d=>{this.productList=d.data.products,this.pages=d.data.pagination}).catch(d=>{_.fire({title:d.response.data.message,icon:"error"})})},openModal(l,s){l==="edit"?(this.tempProduct={...s},this.$refs.editMsg.openModal(),this.tempProduct.imagesUrl||(this.tempProduct={...this.tempProduct,imagesUrl:[]}),this.tempProduct.tags||(this.tempProduct={...this.tempProduct,tags:[]})):l==="new"&&(this.$refs.editMsg.openModal(),this.tempProduct={imagesUrl:[],tags:[]})},deleteProduct(l){_.fire({title:`是否刪除${l.title}(刪除後將無法恢復)？`,showCancelButton:!0,confirmButtonText:"刪除",cancelButtonText:"取消"}).then(s=>{if(s.isConfirmed){const d=`${D}api/${A}/admin/product/${l.id}`;this.$http.delete(d).then(()=>{this.getProducts(),_.fire({toast:!0,title:"已刪除商品！",icon:"success",timer:2e3,showConfirmButton:!1})}).catch(P=>{_.fire({title:P.response.data.message,icon:"error"})})}})}},mounted(){this.getProducts()}},Rt={class:"container py-5"},St={class:"row justify-content-center"},qt={class:"col-lg-8"},Ht=t("h1",{class:"fs-5 mb-3"},"商品管理",-1),Gt={class:"text-end"},Ot={class:"table"},Nt=t("thead",null,[t("tr",null,[t("th",null,"分類"),t("th",null,"商品名稱"),t("th",null,"原價"),t("th",null,"售價"),t("th",null,"是否啟用"),t("th")])],-1),jt=["onClick"],zt=["onClick"];function Jt(l,s,d,P,e,c){const m=y("pagination"),u=y("editModal");return n(),r("div",Rt,[t("div",St,[t("div",qt,[Ht,t("div",Gt,[t("button",{type:"button",class:"btn btn-primary",onClick:s[0]||(s[0]=a=>c.openModal("new"))}," 建立新的商品 ")]),t("table",Ot,[Nt,t("tbody",null,[(n(!0),r(v,null,w(e.productList,a=>(n(),r("tr",{key:a.id},[t("td",null,b(a.category),1),t("td",null,b(a.title),1),t("td",null,b(a.origin_price),1),t("td",null,b(a.price),1),t("td",null,[t("p",null,b(a.is_enabled===1?"啟用":"未啟用"),1)]),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:p=>c.openModal("edit",a)}," 編輯 ",8,jt),t("button",{type:"button",class:"btn btn-sm btn-outline-danger ms-1",onClick:p=>c.deleteProduct(a)}," 刪除 ",8,zt)])]))),128))])]),i(m,{class:"mt-2",pages:e.pages,onGetCurrentPage:c.getCurrentPage},null,8,["pages","onGetCurrentPage"])])]),i(u,{ref:"editMsg","temp-product":e.tempProduct,onGetProduct:c.getProducts},null,8,["temp-product","onGetProduct"])])}const Yt=B(Lt,[["render",Jt]]);export{Yt as default};
