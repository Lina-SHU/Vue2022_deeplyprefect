import{S as c}from"./sweetalert2.all-9d19fef7.js";import{M as V,p as w}from"./modal-f997152b.js";import{_ as M,o as r,c as m,e as t,t as a,j as p,G as u,I as D,r as _,F as T,i as E,f}from"./index-3125bab5.js";import"./component-functions-982abf74.js";const{VITE_URL:b,VITE_PATH:C}={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"lina-vueapi",BASE_URL:"/Vue2022_week6/",MODE:"production",DEV:!1,PROD:!0},k={props:["tempCoupon"],data(){return{editMsg:"",temp:{},date:""}},methods:{openModal(){this.editMsg.show()},closeModal(){this.editMsg.hide()},editCoupon(){if(this.temp.percent>100||this.temp.percent<0){c.fire({title:"優惠券折扣需在 100 內！",icon:"warning"});return}let n=`${b}api/${C}/admin/coupon/${this.temp.id}`,e="put";this.temp.id||(n=`${b}api/${C}/admin/coupon`,e="post"),this.temp.due_date=Math.floor(new Date(this.date)/1e3),this.$http[e](n,{data:this.temp}).then(()=>{this.$emit("getCoupons"),this.closeModal(),this.temp.id?c.fire({toast:!0,title:"編輯優惠券成功！",icon:"success",timer:2e3,position:"top-end",showConfirmButton:!1}):c.fire({toast:!0,title:"新增優惠券成功！",icon:"success",timer:2e3,position:"top-end",showConfirmButton:!1}),this.temp={}})}},watch:{tempCoupon(){this.temp={...this.tempCoupon},this.temp.due_date?this.date=`${new Date(this.temp.due_date*1e3).getFullYear()}-${("0"+(new Date(this.temp.due_date*1e3).getMonth()+1)).slice(-2)}-${("0"+new Date(this.temp.due_date*1e3).getDate()).slice(-2)}`:this.date=""}},mounted(){this.editMsg=new V(this.$refs.editCouponModal)}},x={class:"modal",ref:"editCouponModal"},L={class:"modal-dialog modal-dialog-centered"},U={class:"modal-content"},B={class:"modal-header"},I={class:"modal-title fs-5"},R=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),A={class:"modal-body"},P={class:"mb-3"},S=t("label",{for:"couponName",class:"form-label"},"名稱",-1),H={class:"mb-3"},N=t("label",{for:"couponCode",class:"form-label"},"代碼",-1),O={class:"mb-3"},F=t("label",{for:"couponDiscount",class:"form-label"},"折扣數",-1),G={class:"mb-3"},j=t("label",{for:"couponDiscount",class:"form-label"},"到期日",-1),Y={class:"mb-3"},q={class:"form-check"},z=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),J={class:"modal-footer"},K=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Q(n,e,l,h,o,d){return r(),m("div",x,[t("div",L,[t("div",U,[t("div",B,[t("h2",I,a(o.temp.id?"編輯":"新增")+"優惠券 ",1),R]),t("div",A,[t("div",P,[S,p(t("input",{type:"text",class:"form-control",id:"couponName","onUpdate:modelValue":e[0]||(e[0]=s=>o.temp.title=s)},null,512),[[u,o.temp.title]])]),t("div",H,[N,p(t("input",{type:"text",class:"form-control",id:"couponCode","onUpdate:modelValue":e[1]||(e[1]=s=>o.temp.code=s)},null,512),[[u,o.temp.code,void 0,{trim:!0}]])]),t("div",O,[F,p(t("input",{type:"number",class:"form-control",id:"couponDiscount","onUpdate:modelValue":e[2]||(e[2]=s=>o.temp.percent=s),max:"100"},null,512),[[u,o.temp.percent,void 0,{number:!0}]])]),t("div",G,[j,p(t("input",{type:"date",class:"form-control",id:"couponDiscount","onUpdate:modelValue":e[3]||(e[3]=s=>o.date=s)},null,512),[[u,o.date]])]),t("div",Y,[t("div",q,[p(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=s=>o.temp.is_enabled=s)},null,512),[[D,o.temp.is_enabled]]),z])])]),t("div",J,[K,t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...s)=>d.editCoupon&&d.editCoupon(...s))},a(o.temp.id?"編輯":"新增"),1)])])])],512)}const W=M(k,[["render",Q]]),{VITE_URL:g,VITE_PATH:v}={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"lina-vueapi",BASE_URL:"/Vue2022_week6/",MODE:"production",DEV:!1,PROD:!0},X={components:{pagination:w,editModal:W},data(){return{couponList:[],pages:{},tempCoupon:{}}},methods:{getCoupons(n=1){const e=`${g}api/${v}/admin/coupons?page=${n}`;this.$http.get(e).then(l=>{this.couponList=l.data.coupons,this.pages=l.data.pagination}).catch(l=>{c.fire({title:l.response.data.message,icon:"error"})})},deleteCoupon(n){const e=`${g}api/${v}/admin/coupon/${n}`;c.fire({title:"確認是否刪除此優惠券？",showCancelButton:!0,confirmButtonText:"刪除",cancelButtonText:"取消"}).then(l=>{l.isConfirmed&&this.$http.delete(e).then(()=>{this.getCoupons(),c.fire({toast:!0,title:"已刪除優惠券",icon:"success",timer:2e3,showConfirmButton:!1})}).catch(h=>{c.fire({title:h.response.data.message,icon:"error"})})})},openModal(n,e){n==="edit"?this.tempCoupon={...e}:n==="new"&&(this.tempCoupon={}),this.$refs.editMsg.openModal()}},mounted(){this.getCoupons()}},Z={class:"container py-5"},tt={class:"row justify-content-center"},et={class:"col-lg-10"},ot=t("h1",{class:"fs-5 mb-3"},"優惠券管理",-1),st={class:"text-end"},nt={class:"table"},it=t("thead",null,[t("tr",null,[t("th",null,"優惠券名稱"),t("th",null,"優惠券代碼"),t("th",null,"折扣數"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th")])],-1),lt=["onClick"],dt=["onClick"];function at(n,e,l,h,o,d){const s=_("pagination"),$=_("editModal");return r(),m("div",Z,[t("div",tt,[t("div",et,[ot,t("div",st,[t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=i=>d.openModal("new"))}," 建立新的優惠券 ")]),t("table",nt,[it,t("tbody",null,[(r(!0),m(T,null,E(o.couponList,i=>(r(),m("tr",{key:i.id},[t("td",null,a(i.title),1),t("td",null,a(i.code),1),t("td",null,a(i.percent),1),t("td",null,a(new Date(i.due_date*1e3).toLocaleDateString()),1),t("td",null,a(i.is_enabled?"是":"否"),1),t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-primary",onClick:y=>d.openModal("edit",i)}," 編輯 ",8,lt),t("button",{type:"button",class:"btn btn-sm btn-outline-danger ms-1",onClick:y=>d.deleteCoupon(i.id)}," 刪除 ",8,dt)])]))),128))])]),f(s,{class:"mt-2",pages:o.pages,"get-coupons":d.getCoupons},null,8,["pages","get-coupons"])])]),f($,{ref:"editMsg","temp-coupon":o.tempCoupon,onGetCoupons:d.getCoupons},null,8,["temp-coupon","onGetCoupons"])])}const mt=M(X,[["render",at]]);export{mt as default};
