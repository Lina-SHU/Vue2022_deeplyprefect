import{S as a}from"./sweetalert2.all-63bbc384.js";import{M as y,p as $}from"./modal-d0dc8bf1.js";import{_ as w,r as h,o as f,c as b,e,t as u,f as n,w as D,n as _,F as k,i as E}from"./index-122c6dcc.js";import"./component-functions-d4c70f62.js";const{VITE_URL:C,VITE_PATH:v}={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"lina-vueapi",BASE_URL:"/Vue2022_deeplyprefect/",MODE:"production",DEV:!1,PROD:!0},T={props:["tempCoupon"],data(){return{editMsg:"",temp:{},date:""}},methods:{openModal(){this.editMsg.show()},closeModal(){this.editMsg.hide()},editCoupon(){if(this.temp.percent>100){a.fire({title:"優惠券折扣不得大於 100 ！",icon:"warning"});return}if(this.temp.percent<0){a.fire({title:"優惠券折扣不得小於 0 ！",icon:"warning"});return}if(new Date(this.date)<new Date){a.fire({title:"到期日需大於今日",icon:"warning"});return}let s=`${C}api/${v}/admin/coupon/${this.temp.id}`,t="put";this.temp.id||(s=`${C}api/${v}/admin/coupon`,t="post"),this.temp.due_date=Math.floor(new Date(this.date)/1e3),this.$http[t](s,{data:this.temp}).then(()=>{this.$emit("getCoupons"),this.closeModal(),this.temp.id?a.fire({toast:!0,title:"編輯優惠券成功！",icon:"success",timer:2e3,position:"top-end",showConfirmButton:!1}):a.fire({toast:!0,title:"新增優惠券成功！",icon:"success",timer:2e3,position:"top-end",showConfirmButton:!1}),this.temp={}}).catch(l=>{a.fire({title:l.response.data.message,icon:"error"})})}},watch:{tempCoupon(){this.temp={...this.tempCoupon},this.temp.is_enabled=this.temp.is_enabled||0,this.temp.due_date?this.date=`${new Date(this.temp.due_date*1e3).getFullYear()}-${("0"+(new Date(this.temp.due_date*1e3).getMonth()+1)).slice(-2)}-${("0"+new Date(this.temp.due_date*1e3).getDate()).slice(-2)}`:this.date=""}},mounted(){this.editMsg=new y(this.$refs.editCouponModal)}},x={class:"modal",ref:"editCouponModal"},P={class:"modal-dialog modal-dialog-centered"},L={class:"modal-content"},U={class:"modal-header"},B={class:"modal-title fs-5"},I=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body"},A={class:"mb-3"},S=e("label",{for:"couponName",class:"form-label"},"名稱",-1),F={class:"mb-3"},H=e("label",{for:"couponCode",class:"form-label"},"代碼",-1),O={class:"mb-3"},q=e("label",{for:"couponDiscount",class:"form-label"},"折扣數",-1),G={class:"mb-3"},N=e("label",{for:"couponDate",class:"form-label"},"到期日",-1),j={class:"mb-3"},z={class:"form-check"},Y=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),J={class:"text-end"},K=e("button",{type:"button",class:"btn btn-outline-primary-dark","data-bs-dismiss":"modal"}," 取消 ",-1),Q={type:"submit",class:"btn btn-primary-dark ms-3"};function W(s,t,l,g,o,r){const c=h("VField"),p=h("error-message"),i=h("VForm");return f(),b("div",x,[e("div",P,[e("div",L,[e("div",U,[e("h2",B,u(o.temp.id?"編輯":"新增")+"優惠券 ",1),I]),e("div",R,[n(i,{onSubmit:r.editCoupon},{default:D(({errors:m})=>[e("div",A,[S,n(c,{type:"text",class:_(["form-control",{"is-invalid":m.名稱}]),id:"couponName",modelValue:o.temp.title,"onUpdate:modelValue":t[0]||(t[0]=d=>o.temp.title=d),name:"名稱",rules:"required"},null,8,["modelValue","class"]),n(p,{name:"名稱",class:"invalid-feedback"})]),e("div",F,[H,n(c,{type:"text",class:_(["form-control",{"is-invalid":m.代碼}]),id:"couponCode",modelValue:o.temp.code,"onUpdate:modelValue":t[1]||(t[1]=d=>o.temp.code=d),modelModifiers:{trim:!0},name:"代碼",rules:"required"},null,8,["modelValue","class"]),n(p,{name:"代碼",class:"invalid-feedback"})]),e("div",O,[q,n(c,{type:"number",class:_(["form-control",{"is-invalid":m.折扣數}]),id:"couponDiscount",modelValue:o.temp.percent,"onUpdate:modelValue":t[2]||(t[2]=d=>o.temp.percent=d),modelModifiers:{number:!0},max:"100",name:"折扣數",rules:"required"},null,8,["modelValue","class"]),n(p,{name:"折扣數",class:"invalid-feedback"})]),e("div",G,[N,n(c,{type:"date",class:_(["form-control",{"is-invalid":m.到期日}]),id:"couponDate",modelValue:o.date,"onUpdate:modelValue":t[3]||(t[3]=d=>o.date=d),name:"到期日",rules:"required"},null,8,["modelValue","class"]),n(p,{name:"到期日",class:"invalid-feedback"})]),e("div",j,[e("div",z,[n(c,{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,modelValue:o.temp.is_enabled,"onUpdate:modelValue":t[4]||(t[4]=d=>o.temp.is_enabled=d),name:"是否啟用"},null,8,["modelValue"]),Y])]),e("div",J,[K,e("button",Q,u(o.temp.id?"編輯":"新增"),1)])]),_:1},8,["onSubmit"])])])])],512)}const X=w(T,[["render",W]]),{VITE_URL:V,VITE_PATH:M}={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"lina-vueapi",BASE_URL:"/Vue2022_deeplyprefect/",MODE:"production",DEV:!1,PROD:!0},Z={components:{pagination:$,editModal:X},data(){return{couponList:[],pages:{},tempCoupon:{},currentPage:1}},methods:{getCurrentPage(s){this.currentPage=s,this.getOrders(this.currentPage)},getCoupons(s=1){const t=`${V}api/${M}/admin/coupons?page=${s}`;this.$http.get(t).then(l=>{this.couponList=l.data.coupons,this.pages=l.data.pagination}).catch(l=>{a.fire({title:l.response.data.message,icon:"error"})})},deleteCoupon(s){const t=`${V}api/${M}/admin/coupon/${s}`;a.fire({title:"確認是否刪除此優惠券？",showCancelButton:!0,confirmButtonText:"刪除",cancelButtonText:"取消"}).then(l=>{l.isConfirmed&&this.$http.delete(t).then(()=>{this.getCoupons(),a.fire({toast:!0,title:"已刪除優惠券",icon:"success",timer:2e3,showConfirmButton:!1})}).catch(g=>{a.fire({title:g.response.data.message,icon:"error"})})})},openModal(s,t){s==="edit"?this.tempCoupon={...t}:s==="new"&&(this.tempCoupon={}),this.$refs.editMsg.openModal()}},mounted(){this.getCoupons()}},ee={class:"container py-5"},te={class:"row justify-content-center"},oe={class:"col-lg-10"},se=e("h1",{class:"fs-5 mb-3"},"優惠券管理",-1),ne={class:"text-end"},ie={class:"table"},le=e("thead",null,[e("tr",null,[e("th",null,"優惠券名稱"),e("th",null,"優惠券代碼"),e("th",null,"折扣數"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th")])],-1),ae=["onClick"],de=["onClick"];function re(s,t,l,g,o,r){const c=h("pagination"),p=h("editModal");return f(),b("div",ee,[e("div",te,[e("div",oe,[se,e("div",ne,[e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=i=>r.openModal("new"))}," 建立新的優惠券 ")]),e("table",ie,[le,e("tbody",null,[(f(!0),b(k,null,E(o.couponList,i=>(f(),b("tr",{key:i.id},[e("td",null,u(i.title),1),e("td",null,u(i.code),1),e("td",null,u(i.percent),1),e("td",null,u(new Date(i.due_date*1e3).toLocaleDateString()),1),e("td",null,u(i.is_enabled?"是":"否"),1),e("td",null,[e("button",{type:"button",class:"btn btn-sm btn-primary",onClick:m=>r.openModal("edit",i)}," 編輯 ",8,ae),e("button",{type:"button",class:"btn btn-sm btn-outline-danger ms-1",onClick:m=>r.deleteCoupon(i.id)}," 刪除 ",8,de)])]))),128))])]),n(c,{class:"mt-2",pages:o.pages,onGetCurrentPage:r.getCurrentPage},null,8,["pages","onGetCurrentPage"])])]),n(p,{ref:"editMsg","temp-coupon":o.tempCoupon,onGetCoupons:r.getCoupons},null,8,["temp-coupon","onGetCoupons"])])}const he=w(Z,[["render",re]]);export{he as default};
